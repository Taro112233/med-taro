// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum AdmissionStatus {
  ADMIT
  DISCHARGED
}

model Patient {
  id             String        @id @default(cuid())
  hospitalNumber String        @unique @map("hospital_number")
  firstName      String        @map("first_name")
  lastName       String        @map("last_name")
  createdAt      DateTime      @default(now()) @map("created_at")
  updatedAt      DateTime      @updatedAt @map("updated_at")

  admissions Admission[]

  @@map("patients")
}

model Admission {
  id              String    @id @default(cuid())
  admissionNumber String    @unique @map("admission_number")
  patientId       String    @map("patient_id")
  bedNumber       String    @map("bed_number")
  admissionDate   DateTime  @map("admission_date")
  dischargeDate   DateTime? @map("discharge_date")
  status          AdmissionStatus @default(ADMIT)
  
  // Clinical fields
  chiefComplaint  String?   @map("chief_complaint") @db.Text  // CC
  historyPresent  String?   @map("history_present") @db.Text  // HPI
  pastMedicalHx   String?   @map("past_medical_hx") @db.Text  // PHM
  familyHistory   String?   @map("family_history") @db.Text   // FH
  socialHistory   String?   @map("social_history") @db.Text   // SH
  allergies       String?   @db.Text                          // ALL
  medications     String?   @db.Text                          // MED
  lab             String?   @db.Text                          // Lab
  note            String?   @db.Text
  
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  patient       Patient         @relation(fields: [patientId], references: [id], onDelete: Cascade)
  progressNotes ProgressNote[]

  @@map("admissions")
}

model ProgressNote {
  id          String   @id @default(cuid())
  admissionId String   @map("admission_id")
  
  // SOAP fields
  subjective  String?  @db.Text
  objective   String?  @db.Text
  assessment  String?  @db.Text
  plan        String?  @db.Text
  
  // Vital signs stored as JSON
  // Structure: {bp: "120/80", hr: 72, rr: 16, temp: 37.0, o2sat: 98}
  vitalSigns  Json?    @map("vital_signs")
  
  note        String?  @db.Text
  createdAt   DateTime @default(now()) @map("created_at")
  createdBy   String   @map("created_by")

  admission Admission @relation(fields: [admissionId], references: [id], onDelete: Cascade)

  @@map("progress_notes")
}